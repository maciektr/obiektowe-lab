package agh.cs.lab4.integration;

import agh.cs.lab4.*;
import org.junit.After;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;
import java.util.ArrayList;
import java.util.List;

public class IntegrationUnboundedMapTest {
    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();
    private final ByteArrayOutputStream errContent = new ByteArrayOutputStream();
    private final PrintStream originalOut = System.out;
    private final PrintStream originalErr = System.err;

    @Before
    public void setUpStreams() {
        System.setOut(new PrintStream(outContent));
        System.setErr(new PrintStream(errContent));
    }

    @After
    public void restoreStreams() {
        System.setOut(originalOut);
        System.setErr(originalErr);
    }

    @Test
    public void testRun(){
        String[] orders = {"f","b", "r","l","f","f","r","r","f","f","f","f","f","f","f","f"};
        List<Rock> rocks = new ArrayList<Rock>();
        rocks.add(new Rock(new Vector2d(-4,-4)));
        rocks.add(new Rock(new Vector2d(7,7)));
        rocks.add(new Rock(new Vector2d(3,6)));
        rocks.add(new Rock(new Vector2d(2,0)));

        MoveDirection[] directions = new OptionsParser().parse(orders);
        IWorldMap map = new UnboundedMap(rocks);

        map.place(new Animal(map));
        map.place(new Animal(map,new Vector2d(3,4)));
        map.run(directions);

        Assert.assertEquals(" y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | |N| | | | |\r\n" +
                "  3: | | | | | | |N| | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |N|N| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |E|N| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |E|W| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |E|W| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |E|W| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |S|W| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | |S|N| | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | |N| | | | |\r\n" +
                "  2: | | | | | | |S| | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | |N| | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | |S| | | | | |\r\n" +
                "  1: | | | | | | | | | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | | | | | | |\r\n" +
                "  4: | | | | | | | |N| | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | |N| | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | |N| | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | |N| | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | |N| | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n" +
                "\r\n" +
                " y\\x -4-3-2-1 0 1 2 3 4 5 6 7\r\n" +
                "  8: -------------------------\r\n" +
                "  7: | | | | | | | | | | | |R|\r\n" +
                "  6: | | | | | | | |R| | | | |\r\n" +
                "  5: | | | | | | | |N| | | | |\r\n" +
                "  4: | | | | | | | | | | | | |\r\n" +
                "  3: | | | | | | | | | | | | |\r\n" +
                "  2: | | | | | | | | | | | | |\r\n" +
                "  1: | | | | | | |S| | | | | |\r\n" +
                "  0: | | | | | | |R| | | | | |\r\n" +
                " -1: | | | | | | | | | | | | |\r\n" +
                " -2: | | | | | | | | | | | | |\r\n" +
                " -3: | | | | | | | | | | | | |\r\n" +
                " -4: |R| | | | | | | | | | | |\r\n" +
                " -5: -------------------------\r\n\r\n", outContent.toString());
    }
}
